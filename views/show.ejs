<% include _head.ejs %>


<section class="section">
    <div class="container">
        <h1 class="title has-text-centered"><a><%- site.origin %></a></h1>

        <canvas id="myChart" height="100"></canvas>
        <form>
            <div class="field">
                <label class="label"># Days to show</label>
                <div class="control">
                    <input id="daysToShow" class="input" type="number" placeholder="7" style="max-width: 120px;">
                    <button class="button is-primary" type="button" onclick="updateDayCount()">Update</button>
                </div>
            </div>
        </form>

        <hr/>

        <table class="table is-fullwidth">
            <thead>
            <tr>
                <th><abbr title="Path">Path</abbr></th>
                <th>Visits</th>
            </tr>
            </thead>
            <tbody>
            <% site.paths.map(path=>{ %>
                <tr>
                    <th><%- path.path %></th>
                    <td><%- path.count %></td>
                </tr>

            <% }) %>
            </tbody>
        </table>

    </div>
</section>


<script>
    var dts = document.getElementById('daysToShow');

    function updateDayCount() {
        insertParam('days', dts.value);
    }

    function insertParam(key, value) {
        key = encodeURI(key);
        value = encodeURI(value);

        var kvp = document.location.search.substr(1).split('&');

        var i = kvp.length;
        var x;
        while (i--) {
            x = kvp[i].split('=');

            if (x[0] == key) {
                x[1] = value;
                kvp[i] = x.join('=');
                break;
            }
        }

        if (i < 0) {
            kvp[kvp.length] = [key, value].join('=');
        }

        //this will reload the page, it's likely better to store this until finished
        document.location.search = kvp.join('&');

        console.log(document.location);
    }


    var siteObject = <%- JSON.stringify(site) %>;
    var ctx = document.getElementById('myChart').getContext('2d');

    var datesArray = siteObject.week.map(function (day) {
        return day.human;
    });

    var valueArray = siteObject.week.map(function (day) {
        return day.count;
    });

    dts.value = siteObject.week.length;

    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: datesArray,
            datasets: [{
                label: '# of visits',
                data: valueArray,
                // backgroundColor: [
                //     'rgba(255, 99, 132, 0.2)',
                //     'rgba(54, 162, 235, 0.2)',
                //     'rgba(255, 206, 86, 0.2)',
                //     'rgba(75, 192, 192, 0.2)',
                //     'rgba(153, 102, 255, 0.2)',
                //     'rgba(255, 159, 64, 0.2)'
                // ],
                // borderColor: [
                //     'rgba(255, 99, 132, 1)',
                //     'rgba(54, 162, 235, 1)',
                //     'rgba(255, 206, 86, 1)',
                //     'rgba(75, 192, 192, 1)',
                //     'rgba(153, 102, 255, 1)',
                //     'rgba(255, 159, 64, 1)'
                // ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>
<% include _foot.ejs %>

